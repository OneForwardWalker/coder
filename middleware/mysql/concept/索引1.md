# innodb如何使用B+树组织数据
![](https://img-blog.csdnimg.cn/img_convert/f7696506a3c1c94621fcbad10341f1a8.png)
## innodb如何存储数据
> innodb以数据页为单位来读写数据，以页为单位和磁盘进行交互.innodb数据页的默认大小是16KB
### 数据页结构
![](https://img-blog.csdnimg.cn/img_convert/243b1466779a9e107ae3ef0155604a17.png)
![](https://img-blog.csdnimg.cn/img_convert/fabd6dadd61a0aa342d7107213955a72.png)
> 文件头上有两个指针，分别指向上一个数据页和下一个数据页，连接起来相当于一个链表

![](https://img-blog.csdnimg.cn/img_convert/557d17e05ce90f18591c2305871af665.png)
> 使得页占用的内存空间是逻辑上的连续

### 页目录
> 数据页中的记录按照主键的顺序组成单向链表，检索效率比较低，所以数据页中有一个页目录，起到检索的作用。
![](https://img-blog.csdnimg.cn/img_convert/261011d237bec993821aa198b97ae8ce.png)
* 页目录的创建过程
> 1. 将所有记录划分成几个组，包括最小记录和最大记录
> 2. 每组的最后一条记录就是组内最大的那条记录，最后一条记录的头信息会存储本组有哪些记录
> 3. 页目录用来存储最后一条记录的地址偏移量，每个槽相当于指针指向了不同组的最后一个记录。

页目录是由多个**槽**组成的，槽作为**分组**记录的索引。查找记录的时候可以跳过槽进行二分查找。


* 利用页目录查询数据
> 二分查找+顺序查找(比如查找分组最小的记录)

* 槽内记录的规定
> 第一个分组中的记录只能有 1 条记录；  
> 最后一个分组中的记录条数范围只能在 1-8 条之间；  
> 剩下的分组中记录条数范围只能在 4-8 条之间  

# B+树如何进行查询
## InnoDB 里的 B+ 树中的每个节点都是一个数据页，结构示意图如下：
![](https://img-blog.csdnimg.cn/img_convert/7c635d682bd3cdc421bb9eea33a5a413.png)

## B+树的特点
1. 只有叶子节点（最底层的节点）才存放了数据，非叶子节点（其他上层节）仅用来存放目录项作为索引。
2. 非叶子节点分为不同层次，通过分层来降低每一层的搜索量；
3. 所有节点按照**索引**键大小排序，构成一个**双向链表**，便于范围查询；
## 查找过程
...
## 聚集索引和二级索引
...
